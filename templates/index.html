<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cricket Win Predictor</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tom Select -->
  <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>

  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Font Awesome 6 Free -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-pbQfV9z+MGrZ37TzX3Tg3NK8lfrH26e0iwjCqV2a8R4bIRpFQT1V0YkXhOWvN6BQ6P+JwF+l5/kI5KroTvFm2Q=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <style>
    /* Custom scrollbar for history */
    #historyBox::-webkit-scrollbar {
      width: 8px;
    }
    #historyBox::-webkit-scrollbar-thumb {
      background-color: rgba(99, 102, 241, 0.6);
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-indigo-100 min-h-screen px-6 py-12 font-sans text-gray-800">
  <div class="flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto">
    <!-- Prediction Form -->
    <section class="w-full lg:w-2/3 bg-white/70 backdrop-blur-md border border-indigo-300 rounded-3xl shadow-lg p-10 space-y-8">
      <header class="text-center">
        <h1 class="text-4xl font-extrabold text-indigo-700 flex justify-center items-center gap-3">
          <i class="fa-solid fa-bullseye text-indigo-600"></i> Cricket Win Predictor
        </h1>
        <p class="mt-2 text-indigo-600 font-semibold tracking-wide">Predict match outcome after 1st innings</p>
      </header>

      <form id="predictForm" class="space-y-6" onsubmit="return handleSubmit(event)" novalidate>
        <div>
          <label for="team" class="block text-sm font-semibold text-indigo-800 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-cricket-bat-ball text-indigo-600"></i> Team
          </label>
          <select id="team" name="team" placeholder="Select team..." class="input-select" required></select>
        </div>

        <div>
          <label for="opponent" class="block text-sm font-semibold text-indigo-800 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-flag-usa text-indigo-600"></i> Opponent
          </label>
          <select id="opponent" name="opponent" placeholder="Select opponent..." class="input-select" required></select>
        </div>

        <div>
          <label for="score" class="block text-sm font-semibold text-indigo-800 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-hashtag text-indigo-600"></i> Score (1st Innings)
          </label>
          <input
            type="number"
            id="score"
            name="score"
            min="0"
            placeholder="Enter score (e.g. 168)"
            class="input-text"
            required
          />
        </div>

        <div>
          <label for="toss" class="block text-sm font-semibold text-indigo-800 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-coins text-indigo-600"></i> Toss Decision
          </label>
          <select
            id="toss"
            name="toss"
            class="input-select"
            required
          >
            <option value="" disabled selected>Select toss decision...</option>
            <option value="bat">Bat</option>
            <option value="bowl">Bowl</option>
          </select>
        </div>

        <div>
          <label for="ground" class="block text-sm font-semibold text-indigo-800 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-person-booth text-indigo-600"></i> Ground
          </label>
          <select id="ground" name="ground" placeholder="Select ground..." class="input-select" required></select>
        </div>

        <div id="errorBox" class="text-red-600 text-sm font-medium hidden"></div>

        <div class="flex justify-center">
          <button
            type="submit"
            class="bg-indigo-700 hover:bg-indigo-800 text-white font-semibold py-3 px-8 rounded-xl shadow-lg flex items-center gap-3 transition duration-200"
          >
            <i class="fa-solid fa-chart-line animate-pulse"></i> Predict Result
          </button>
        </div>
      </form>
    </section>

    <!-- History Sidebar -->
    <aside
      class="w-full lg:w-1/3 bg-white/70 backdrop-blur-md border border-indigo-300 rounded-3xl shadow-lg p-6 flex flex-col max-h-[720px]"
      aria-label="Prediction History"
    >
      <div class="flex justify-between items-center mb-5">
        <h2 class="text-2xl font-bold text-indigo-700 flex items-center gap-3">
          <i class="fa-solid fa-clock-rotate-left"></i> Prediction History
        </h2>
        <button
          onclick="clearHistory()"
          class="text-sm text-red-600 hover:text-red-700 font-semibold transition"
          aria-label="Clear prediction history"
        >
          Clear
        </button>
      </div>
      <div
        id="historyBox"
        class="space-y-4 overflow-y-auto text-indigo-900 flex-grow"
      ></div>
    </aside>
  </div>

  <script>
    // Apply some repeated Tailwind classes via JS for form controls (to keep HTML clean)
    const inputSelectClass =
      "w-full rounded-lg border border-indigo-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-600 px-4 py-3 text-indigo-800 sm:text-base";
    const inputTextClass = inputSelectClass + "";

    // After DOM loads
    document.addEventListener("DOMContentLoaded", () => {
      // Add classes to selects and inputs
      document.querySelectorAll("select.input-select").forEach((el) => {
        el.className = inputSelectClass;
      });
      document.querySelectorAll("input.input-text").forEach((el) => {
        el.className = inputTextClass;
      });

      // Initialize dropdowns
      initDropdown("team", "/static/teams.json");
      initDropdown("opponent", "/static/teams.json");
      initDropdown("ground", "/static/grounds.json");

      renderHistory();

      // Replace feather icons (not used but in case)
      feather.replace();
    });

    function initDropdown(id, url) {
      fetch(url)
        .then((res) => res.json())
        .then((data) => {
          const select = document.getElementById(id);
          // Clear any existing options (to avoid duplicates on re-init)
          select.innerHTML = "";

          // Default placeholder option
          const defaultOption = document.createElement("option");
          defaultOption.value = "";
          defaultOption.textContent = "Select " + id + "...";
          defaultOption.disabled = true;
          defaultOption.selected = true;
          select.appendChild(defaultOption);

          data.forEach((item) => {
            const opt = document.createElement("option");
            opt.value = item;
            opt.textContent = item;
            select.appendChild(opt);
          });

          // Initialize Tom Select
          new TomSelect(`#${id}`, {
            create: false,
            sortField: "text",
            maxItems: 1,
            dropdownParent: "body",
          });
        })
        .catch(() => {
          const select = document.getElementById(id);
          select.innerHTML = '<option value="">Failed to load options</option>';
        });
    }

    function validateForm() {
      const team = document.getElementById("team").value;
      const opponent = document.getElementById("opponent").value;
      const score = document.getElementById("score").value;
      const toss = document.getElementById("toss").value;
      const ground = document.getElementById("ground").value;
      const errorBox = document.getElementById("errorBox");

      errorBox.classList.add("hidden");
      errorBox.textContent = "";

      if (!team || !opponent || !score || !toss || !ground) {
        errorBox.textContent = "Please fill out all fields.";
        errorBox.classList.remove("hidden");
        return false;
      }

      if (team === opponent) {
        errorBox.textContent = "Team and Opponent cannot be the same.";
        errorBox.classList.remove("hidden");
        return false;
      }

      if (score <= 0) {
        errorBox.textContent = "Score must be greater than 0.";
        errorBox.classList.remove("hidden");
        return false;
      }

      return true;
    }

    function handleSubmit(e) {
      e.preventDefault();
      if (!validateForm()) return false;

      const team = document.getElementById("team").value;
      const opponent = document.getElementById("opponent").value;
      const score = document.getElementById("score").value;
      const toss = document.getElementById("toss").value;
      const ground = document.getElementById("ground").value;

      // Dummy prediction (replace with real prediction logic/backend call)
      const result = Math.random() > 0.5 ? `${team} Wins` : `${opponent} Wins`;

      // Save history (most recent first)
      const history = JSON.parse(localStorage.getItem("predictionHistory")) || [];
      history.unshift({ team, opponent, score, toss, ground, result });
      localStorage.setItem("predictionHistory", JSON.stringify(history));

      renderHistory();

      alert("Prediction: " + result);

      // Optionally clear or reset form here:
      // e.target.reset();

      return false;
    }

    function renderHistory() {
      const historyBox = document.getElementById("historyBox");
      const history = JSON.parse(localStorage.getItem("predictionHistory")) || [];

      if (history.length === 0) {
        historyBox.innerHTML = `<p class="italic text-indigo-500">No predictions yet.</p>`;
        return;
      }

      historyBox.innerHTML = "";
      history.forEach((item) => {
        const div = document.createElement("div");
        div.className =
          "p-4 border border-indigo-200 rounded-2xl bg-indigo-50 shadow-sm transition hover:shadow-md";
        div.innerHTML = `
          <div class="text-indigo-900 font-semibold text-lg mb-1">${item.team} <i class="fa-solid fa-vs"></i> ${item.opponent}</div>
          <div class="text-indigo-700 text-sm mb-2">
            <i class="fa-solid fa-hashtag mr-1"></i> Score: ${item.score} &nbsp;&nbsp;
            <i class="fa-solid fa-coins mr-1"></i> Toss: ${item.toss} &nbsp;&nbsp;
            <i class="fa-solid fa-person-booth mr-1"></i> Ground: ${item.ground}
          </div>
          <div class="text-indigo-800 font-semibold text-base">
            <i class="fa-solid fa-chart-line mr-2 text-green-600"></i> ${item.result}
          </div>
        `;
        historyBox.appendChild(div);
      });
    }

    function clearHistory() {
      if (confirm("Are you sure you want to clear all prediction history?")) {
        localStorage.removeItem("predictionHistory");
        renderHistory();
      }
    }
  </script>
</body>
</html>
